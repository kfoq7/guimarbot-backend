---
import { EnrolleCard } from '@/components/Enrolle'
import Section from '@/components/ui/Section.astro'
import type { Plan } from '@/types/Plan'

const response = await fetch(`${import.meta.env.PUBLIC_API_URL}/plan`)
const rawData = await response.json()

const data: Plan[] = rawData.map((item: any) => ({
  ...item,
  price: parseFloat(item.price),
  emphasis: getEmphasis(item)
}))

function getEmphasis(plan: any): 'low' | 'medium' | 'high' {
  return plan.price < 50
    ? 'low'
    : plan.price < 100
      ? 'medium'
      : plan.price >= 150
        ? 'high'
        : 'low'
}
---

<Section>
  <h1 class="text-center text-2xl font-bold md:text-3xl">
    Elige el plan que mejor se adapte a ti
  </h1>

  <p class="mt-2 text-pretty text-center text-lg">
    Mejora tu oportunidad de crecimiento personal y profesional.
  </p>

  <div
    class="mt-14 flex flex-col items-center justify-center gap-x-5 gap-y-4 md:flex-row"
  >
    {
      data.map(plan => (
        <EnrolleCard
          name={plan.name}
          price={plan.price}
          maxUsers={plan.maxUsers}
          description={plan.description}
          emphasis={plan.emphasis}
        />
      ))
    }
  </div>
</Section>
